/* =========================================================
   tts.js
   Role: Text To Speech (Guaranteed, Browser Native)
   Works on: Android Chrome, Samsung Internet
   ========================================================= */

(function (window) {
  "use strict";

  if (!("speechSynthesis" in window)) {
    console.error("SpeechSynthesis not supported");
    return;
  }

  let unlocked = false;

  // ðŸ”“ Mobile audio unlock (MANDATORY)
  function unlock() {
    if (unlocked) return;
    const u = new SpeechSynthesisUtterance(" ");
    u.volume = 0;
    window.speechSynthesis.speak(u);
    unlocked = true;
  }

  // First user gesture unlock
  document.addEventListener("click", unlock, { once: true });
  document.addEventListener("touchstart", unlock, { once: true });

  const TTS = {
    init() {
      unlock();
    },

    speak(text) {
      if (!text) return;
      unlock();
      window.speechSynthesis.cancel();

      const u = new SpeechSynthesisUtterance(text);
      u.lang = "hi-IN";
      u.rate = 1;
      u.pitch = 1;
      u.volume = 1;

      window.speechSynthesis.speak(u);
    },

    stop() {
      window.speechSynthesis.cancel();
    }
  };

  window.TTS = TTS;

})(window);