/* =========================================================
   voice/tts.js
   ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ: ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§ï‡•Ä ‡§µ‡§æ‡§£‡•Ä (Text To Speech)
   ‡§∏‡§ø‡§¶‡•ç‡§ß‡§æ‡§Ç‡§§: ‚Äú‡§∏‡§Ç‡§µ‡§æ‡§¶-‡§∏‡§Ç‡§π‡§ø‡§§‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§¨‡•ã‡§≤‡§®‡§æ‚Äù
   ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞‡§§‡§æ: core/AdminControl.js
   ========================================================= */

(function (window) {
  "use strict";

  /* ---------------------------------------------------------
     ‡§™‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§ø‡§ï ‡§ú‡§æ‡§Å‡§ö
     --------------------------------------------------------- */
  if (!("speechSynthesis" in window)) {
    console.error("‡§Ø‡§π ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§");
    return;
  }

  let currentUtterance = null;

  /* =========================================================
     ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§ï‡•Ä ‡§µ‡§æ‡§£‡•Ä ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ï
     ========================================================= */
  const TTS = {

    /* =====================================================
       1Ô∏è‚É£ ‡§™‡§π‡§ö‡§æ‡§®-‡§∏‡§Ç‡§π‡§ø‡§§‡§æ (Identity Clause)
       ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§≠‡•ç‡§∞‡§Æ‡§ï‡§æ‡§∞‡•Ä ‡§Ø‡§æ ‡§Ö‡§∏‡§§‡•ç‡§Ø ‡§™‡§π‡§ö‡§æ‡§® ‡§µ‡§æ‡§≤‡•á ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§¨‡•ã‡§≤‡•á‡§ó‡•Ä
       ===================================================== */
    ‡§™‡§π‡§ö‡§æ‡§®_‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§(text) {
      return AdminControl.filterText(text);
    },

    /* =====================================================
       2Ô∏è‚É£ ‡§∏‡§Ç‡§¨‡•ã‡§ß‡§®-‡§∏‡§Ç‡§π‡§ø‡§§‡§æ (Addressing Rules)
       ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§Ø‡§æ ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ ‡§ú‡§§‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§∂‡§¨‡•ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§¨‡•ã‡§≤‡§®‡•á
       ===================================================== */
    ‡§∏‡§Ç‡§¨‡•ã‡§ß‡§®_‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§(text) {
      return AdminControl.filterText(text);
    },

    /* =====================================================
       3Ô∏è‚É£ ‡§∏‡•ç‡§®‡•á‡§π-‡§∏‡•ç‡§§‡§∞ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ (Affection Levels)
       ‡§™‡•ç‡§∞‡•á‡§Æ‡§ø‡§ï‡§æ-‡§∏‡§¶‡•É‡§∂ ‡§∏‡§Ç‡§µ‡§æ‡§¶ ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•ç‡§§‡§∞ 3 ‡§™‡§∞
       ===================================================== */
    ‡§∏‡•ç‡§®‡•á‡§π_‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø(options) {
      if (options.type === "romantic") {
        return AdminControl.canSpeak("romantic");
      }
      return true;
    },

    /* =====================================================
       4Ô∏è‚É£ ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Å (Emotional Boundaries)
       ‡§à‡§∞‡•ç‡§∑‡•ç‡§Ø‡§æ, ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞‡§§‡§æ, ‡§¶‡§¨‡§æ‡§µ ‡§ú‡•à‡§∏‡•á ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§®‡§ø‡§∑‡§ø‡§¶‡•ç‡§ß
       ===================================================== */
    ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï_‡§∏‡•Ä‡§Æ‡§æ(text) {
      return AdminControl.filterText(text);
    },

    /* =====================================================
       5Ô∏è‚É£ ‡§â‡§§‡•ç‡§§‡§∞-‡§∏‡§Ç‡§π‡§ø‡§§‡§æ (Response Discipline)
       ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§î‡§∞ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§¨‡•ã‡§≤‡§®‡§æ
       ===================================================== */
    ‡§â‡§§‡•ç‡§§‡§∞_‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§®(text) {
      return typeof text === "string" && text.trim().length > 0;
    },

    /* =====================================================
       6Ô∏è‚É£ ‡§∏‡•Ä‡§ñ-‡§∏‡§Ç‡§π‡§ø‡§§‡§æ (Learning Ethics)
       TTS ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ï‡•ã‡§à ‡§®‡§Ø‡§æ ‡§≠‡§æ‡§µ ‡§Ø‡§æ ‡§∏‡§§‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§ó‡§¢‡§º‡•á‡§ó‡§æ
       ===================================================== */
    ‡§∏‡•Ä‡§ñ_‡§®‡§ø‡§Ø‡§Æ() {
      return true; // TTS ‡§∏‡•Ä‡§ñ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ, ‡§ï‡•á‡§µ‡§≤ ‡§¨‡•ã‡§≤‡§§‡§æ ‡§π‡•à
    },

    /* =====================================================
       7Ô∏è‚É£ ‡§Æ‡•å‡§® ‡§î‡§∞ ‡§µ‡§ø‡§∞‡§æ‡§Æ (Silence Protocol)
       ‡§Æ‡•å‡§® ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§Ö‡§Ç‡§ú‡§≤‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¨‡•ã‡§≤‡•á‡§ó‡•Ä
       ===================================================== */
    ‡§Æ‡•å‡§®_‡§∏‡•ç‡§•‡§ø‡§§‡§ø(options) {
      return options.silent === true;
    },

    /* =====================================================
       8Ô∏è‚É£ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§∏‡§§‡•ç‡§Ø ‡§®‡§ø‡§Ø‡§Æ (Final Authority Rule)
       ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø AdminControl ‡§ï‡§æ ‡§π‡•ã‡§ó‡§æ
       ===================================================== */
    ‡§Ö‡§Ç‡§§‡§ø‡§Æ_‡§∏‡§§‡•ç‡§Ø() {
      return !!window.AdminControl;
    },

    /* =====================================================
       üîä speak(): ‡§∏‡§Ç‡§π‡§ø‡§§‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§¨‡•ã‡§≤‡§®‡§æ
       ===================================================== */
    speak(text, options = {}) {

      /* ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§∏‡§§‡•ç‡§Ø ‡§ú‡§æ‡§Å‡§ö */
      if (!this.‡§Ö‡§Ç‡§§‡§ø‡§Æ_‡§∏‡§§‡•ç‡§Ø()) return false;

      /* ‡§Æ‡•å‡§® */
      if (this.‡§Æ‡•å‡§®_‡§∏‡•ç‡§•‡§ø‡§§‡§ø(options)) return false;

      /* ‡§â‡§§‡•ç‡§§‡§∞ ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§® */
      if (!this.‡§â‡§§‡•ç‡§§‡§∞_‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§®(text)) return false;

      /* ‡§™‡§π‡§ö‡§æ‡§® + ‡§∏‡§Ç‡§¨‡•ã‡§ß‡§® + ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡•Ä‡§Æ‡§æ */
      const ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§_‡§™‡§æ‡§† = this.‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï_‡§∏‡•Ä‡§Æ‡§æ(text);
      if (!‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§_‡§™‡§æ‡§†) return false;

      /* ‡§∏‡•ç‡§®‡•á‡§π ‡§∏‡•ç‡§§‡§∞ */
      if (!this.‡§∏‡•ç‡§®‡•á‡§π_‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø(options)) return false;

      /* ‡§™‡§π‡§≤‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∞‡•ã‡§ï‡•á‡§Ç */
      window.speechSynthesis.cancel();

      const ‡§µ‡§æ‡§ï‡•ç‡§Ø = new SpeechSynthesisUtterance(‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§_‡§™‡§æ‡§†);

/* -------------------------------------------------
         ‡§∏‡•ç‡§®‡•á‡§π-‡§∏‡•ç‡§§‡§∞ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§∏‡•ç‡§µ‡§∞
         ------------------------------------------------- */
      const ‡§∏‡•ç‡§§‡§∞ = AdminControl.getAffectionLevel();

      ‡§µ‡§æ‡§ï‡•ç‡§Ø.lang = "hi-IN";
      ‡§µ‡§æ‡§ï‡•ç‡§Ø.volume = 1;

      if (‡§∏‡•ç‡§§‡§∞ === 0) {
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.rate = 1;
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.pitch = 1;
      } else if (‡§∏‡•ç‡§§‡§∞ === 1) {
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.rate = 0.95;
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.pitch = 1;
      } else if (‡§∏‡•ç‡§§‡§∞ === 2) {
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.rate = 0.9;
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.pitch = 1.05;
      } else if (‡§∏‡•ç‡§§‡§∞ === 3) {
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.rate = 0.85;
        ‡§µ‡§æ‡§ï‡•ç‡§Ø.pitch = 1.1;
      }

      currentUtterance = ‡§µ‡§æ‡§ï‡•ç‡§Ø;
      window.speechSynthesis.speak(‡§µ‡§æ‡§ï‡•ç‡§Ø);
      return true;
    },

    /* =====================================================
       stop(): ‡§¨‡•ã‡§≤‡§®‡§æ ‡§∞‡•ã‡§ï‡§®‡§æ
       ===================================================== */
    stop() {
      window.speechSynthesis.cancel();
      currentUtterance = null;
      return true;
    },

    /* =====================================================
       ‡§∏‡•ç‡§•‡§ø‡§§‡§ø
       ===================================================== */
    isSpeaking() {
      return window.speechSynthesis.speaking;
    }
  };

  /* ---------------------------------------------------------
     ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§∞‡§æ‡§®‡§æ
     --------------------------------------------------------- */
  Object.defineProperty(window, "TTS", {
    value: TTS,
    writable: false,
    configurable: false
  });

})(window);
