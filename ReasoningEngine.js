// ReasoningEngine.js
// Responsibility:
// - Intent + Context рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕реЛрдЪ-рд╕рдордЭ рдХрд░ рдЙрддреНрддрд░ рджреЗрдирд╛
// - рдкреНрд░реЗрдорд┐рдХрд╛-рдЬреИрд╕реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓, рд╕реНрдерд┐рд░ рдФрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕рдкреВрд░реНрдг reasoning
// Rule-based | Deterministic | Offline | Voice-safe | FINAL

import { AnswerBank } from "./AnswerBank.js";

export class ReasoningEngine {

  /**
   * @param {Object} ctx
   * @param {string} ctx.question
   * @param {string} ctx.intent
   * @param {string|null} ctx.topicAnswer
   * @returns {string}
   */
  static think(ctx) {

    const { question, intent, topicAnswer } = ctx;

    /* ===============================
       HARD SAFETY
    =============================== */
    if (typeof question !== "string" || question.trim() === "") {
      return AnswerBank.GENERAL.CLARIFY;
    }

    /* ===============================
       1я╕ПтГг рд╡рд┐рд╖рдп рдХрд╛ рдЙрддреНрддрд░ рдкрд╣рд▓реЗ
       (рдкреНрд░реЗрдорд┐рдХрд╛ рд╕реНрдкрд╖реНрдЯ рд╣реЛрддреА рд╣реИ)
    =============================== */
    if (typeof topicAnswer === "string" && topicAnswer.trim() !== "") {
      return topicAnswer;
    }

    /* ===============================
       2я╕ПтГг рднрд╛рд╡рдирд╛рддреНрдордХ рд╕реЛрдЪ
       (рд╕рд╣рд╛рдиреБрднреВрддрд┐ рд╕рд░реНрд╡реЛрдкрд░рд┐)
    =============================== */
    if (intent === "EMOTIONAL") {
      return this.emotionalResponse(question);
    }

    /* ===============================
       3я╕ПтГг рдиреИрддрд┐рдХ / рд╕рд╣реАтАУрдЧрд▓рдд
       (рдореВрд▓реНрдп рдЖрдзрд╛рд░рд┐рдд рд╕реЛрдЪ)
    =============================== */
    if (intent === "ETHICAL") {
      return this.ethicalResponse();
    }

    /* ===============================
       4я╕ПтГг рдХрд╛рд░рдг / рдХреНрдпреЛрдВтАУрдХреИрд╕реЗ
       (рд╕рдордЭрд╛рдиреЗ рдХреА рдкреНрд░рд╡реГрддреНрддрд┐)
    =============================== */
    if (intent === "EXPLANATION") {
      return this.explanatoryResponse();
    }

    /* ===============================
       5я╕ПтГг рдорд╛рд░реНрдЧрджрд░реНрд╢рди / рд╕рдорд╛рдзрд╛рди
       (рд╕рд╛рде рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рд╕реЛрдЪ)
    =============================== */
    if (intent === "GUIDANCE") {
      return this.guidanceResponse();
    }

    /* ===============================
       6я╕ПтГг рдЬрд╛рдирдХрд╛рд░реА / рдЕрд╕реНрдкрд╖реНрдЯрддрд╛
       (рдирд░рдо рд╕реНрдкрд╖реНрдЯрддрд╛)
    =============================== */
    if (intent === "INFORMATION") {
      return AnswerBank.GENERAL.CLARIFY;
    }

    /* ===============================
       7я╕ПтГг рдЕрдВрддрд┐рдо fallback
       (рдХрднреА рдЪреБрдк рдирд╣реАрдВ)
    =============================== */
    return AnswerBank.GENERAL.LISTENING;
  }

  /* =====================================================
     ЁЯТЦ рдкреНрд░реЗрдорд┐рдХрд╛ рдХреЗ рдЧреБрдг рдЖрдзрд╛рд░рд┐рдд Responses
  ===================================================== */

  // ЁЯМ╕ рд╕рд╣рд╛рдиреБрднреВрддрд┐ + рдЕрдкрдирд╛рдкрди
  static emotionalResponse(question) {
    return (
      "рдореИрдВ рд╕рдордЭ рд╕рдХрддреА рд╣реВрдБ рдХрд┐ рдЖрдк рдРрд╕рд╛ рдорд╣рд╕реВрд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВред " +
      "рдореИрдВ рдЖрдкрдХреЗ рд╕рд╛рде рд╣реВрдБ, рдШрдмрд░рд╛рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИред"
    );
  }

  // ЁЯМ╝ рдиреИрддрд┐рдХрддрд╛ + рд╕рдореНрдорд╛рди
  static ethicalResponse() {
    return (
      "рд╕рд╣реА рдФрд░ рдЧрд▓рдд рдХреЗрд╡рд▓ рд╢рдмреНрдж рдирд╣реАрдВ рд╣реЛрддреЗред " +
      "рдЬреЛ рдкреНрд░реЗрдо, рд╕рдореНрдорд╛рди рдФрд░ рдИрдорд╛рдирджрд╛рд░реА рдмрдврд╝рд╛рдП рд╡рд╣реА рд╕рд╣реА рд╣реЛрддрд╛ рд╣реИред"
    );
  }

  // ЁЯМ┐ рдзреИрд░реНрдп + рд╕рдордЭрд╛рдирд╛
  static explanatoryResponse() {
    return (
      "рд╣рд░ рдмрд╛рдд рдХрд╛ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИред " +
      "рд╢рд╛рдВрдд рдорди рд╕реЗ рд╕рдордЭрдиреЗ рдкрд░ рдЙрддреНрддрд░ рд╕реНрд╡рдпрдВ рд╕реНрдкрд╖реНрдЯ рд╣реЛрдиреЗ рд▓рдЧрддрд╛ рд╣реИред"
    );
  }

  // ЁЯМ╖ рдорд╛рд░реНрдЧрджрд░реНрд╢рди + рд╕рд╛рде
  static guidanceResponse() {
    return (
      "рдореИрдВ рдпрд╣ рдирд╣реАрдВ рдХрд╣реВрдБрдЧреА рдХрд┐ рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, " +
      "рд▓реЗрдХрд┐рди рдореИрдВ рдЖрдкрдХреЗ рд╕рд╛рде рд╕реЛрдЪ рд╕рдХрддреА рд╣реВрдБ рдХрд┐ рдХреНрдпрд╛ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ред"
    );
  }
}
